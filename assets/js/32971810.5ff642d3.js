"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9651],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=s(n),c=i,m=h["".concat(p,".").concat(c)]||h[c]||d[c]||a;return n?o.createElement(m,r(r({ref:t},u),{},{components:n})):o.createElement(m,r({ref:t},u))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9415:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var o=n(7462),i=(n(7294),n(3905));const a={title:"Handoff"},r=void 0,l={unversionedId:"lab/handoff",id:"lab/handoff",title:"Handoff",description:"This guide requires expo@49.0.0-alpha.3 or greater\u2013\u2013everything listed here is still experimental. You may need to use Expo CLI on main to use these features.",source:"@site/docs/lab/handoff.md",sourceDirName:"lab",slug:"/lab/handoff",permalink:"/router/docs/lab/handoff",draft:!1,editUrl:"https://github.com/expo/router/tree/main/docs/docs/lab/handoff.md",tags:[],version:"current",frontMatter:{title:"Handoff"},sidebar:"tutorialSidebar",previous:{title:"Async Routes",permalink:"/router/docs/lab/bundle-splitting"},next:{title:"Testing with Jest",permalink:"/router/docs/lab/jest"}},p={},s=[{value:"Setup",id:"setup",level:2},{value:"Usage",id:"usage",level:2},{value:"Meta Tags",id:"meta-tags",level:3},{value:"Testing",id:"testing",level:2},{value:"Trouble Shooting",id:"trouble-shooting",level:2},{value:"Still Stuck?",id:"still-stuck",level:3},{value:"Known Issues",id:"known-issues",level:2}],u={toc:s};function d(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This guide requires ",(0,i.kt)("inlineCode",{parentName:"p"},"expo@49.0.0-alpha.3")," or greater\u2013\u2013everything listed here is still experimental. You may need to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/expo/expo/tree/main/packages/%40expo/cli#contributing"},"use Expo CLI on ",(0,i.kt)("inlineCode",{parentName:"a"},"main"))," to use these features.")),(0,i.kt)("p",null,"Handoff is a feature that enables users to continue browsing your app or website on another device. This functionality is generally very useful for users, but it can be difficult to implement. Expo Router streamlines a lot of the complexity of handoff by providing a simple API."),(0,i.kt)("p",null,"In Expo Router, the underlying iOS API (",(0,i.kt)("inlineCode",{parentName:"p"},"NSUserActivity"),") requires a ",(0,i.kt)("inlineCode",{parentName:"p"},"webpageUrl")," which the OS recommends as the current URL for switching to your app. The ",(0,i.kt)("inlineCode",{parentName:"p"},"expo-router/head")," component has a native module which can be used to automatically set the ",(0,i.kt)("inlineCode",{parentName:"p"},"webpageUrl")," to the current URL."),(0,i.kt)("h2",{id:"setup"},"Setup"),(0,i.kt)("p",null,"The following restrictions and considerations are very important:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Handoff is Apple-only."),(0,i.kt)("li",{parentName:"ul"},"Handoff can not be used in the Expo Go app as it requires build-time configuration."),(0,i.kt)("li",{parentName:"ul"},"Handoff requires ",(0,i.kt)("a",{parentName:"li",href:"/docs/guides/universal-links"},"universal links")," to be configured."),(0,i.kt)("li",{parentName:"ul"},"Handoff requires the ",(0,i.kt)("inlineCode",{parentName:"li"},"expo-router/head")," component to be used on each page that you want to support.")),(0,i.kt)("p",null,"Ensure your ",(0,i.kt)("inlineCode",{parentName:"p"},"public/.well-known/apple-app-site-association")," file is configured correctly. It must contain the ",(0,i.kt)("inlineCode",{parentName:"p"},"activitycontinuation")," key with the ",(0,i.kt)("inlineCode",{parentName:"p"},"apps")," array containing your app's bundle ID and Team ID formatted as ",(0,i.kt)("inlineCode",{parentName:"p"},"<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"),", e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"QQ57RJ5UTD.app.expo.acme")," where ",(0,i.kt)("inlineCode",{parentName:"p"},"QQ57RJ5UTD")," is the Team ID and ",(0,i.kt)("inlineCode",{parentName:"p"},"app.expo.acme")," is the bundle identifier."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:"title=public/.well-known/apple-app-site-association",title:"public/.well-known/apple-app-site-association"},'{\n  "applinks": {\n    "details": [\n      {\n        "appIDs": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"],\n        "components": [\n          {\n            "/": "*",\n            "comment": "Matches all routes"\n          }\n        ]\n      }\n    ]\n  },\n  "activitycontinuation": {\n    "apps": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"]\n  },\n  "webcredentials": {\n    "apps": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"]\n  }\n}\n')),(0,i.kt)("p",null,"The associated domains must be configured and signed, even in development. You can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"EXPO_TUNNEL_SUBDOMAIN")," environment variable to configure the subdomain for your development tunnel. The tunnel is required for testing in development because you need SSL to use universal links, Expo CLI provides built-in support for this by running ",(0,i.kt)("inlineCode",{parentName:"p"},"npx expo start --tunnel"),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"EXPO_TUNNEL_SUBDOMAIN")," must be unique as any user can be using the subdomain at any time. You can use a random string or your GitHub username. However, the URL must match what is in your native ",(0,i.kt)("inlineCode",{parentName:"p"},"ios/<project>/<project>.entitlements")," file under the ",(0,i.kt)("inlineCode",{parentName:"p"},"com.apple.developer.associated-domains")," key.")),(0,i.kt)("p",null,"Ensure you set the Handoff origin in your ",(0,i.kt)("inlineCode",{parentName:"p"},"app.config.js")," file. This is the URL that will be used for the ",(0,i.kt)("inlineCode",{parentName:"p"},"webpageUrl")," when the user switches to your app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=app.config.js",title:"app.config.js"},'// Be sure to change this to be unique to your project.\nprocess.env.EXPO_TUNNEL_SUBDOMAIN = "bacon-router-sandbox";\n\nconst ngrokUrl = `${process.env.EXPO_TUNNEL_SUBDOMAIN}.ngrok.io`;\n\n/** @type {import(\'expo/config\').ExpoConfig} */\nmodule.exports = {\n  // ...\n  ios: {\n    bundleIdentifier: "...",\n    associatedDomains: [\n      // highlight-next-line\n      `applinks:${ngrokUrl}`,\n      // highlight-next-line\n      `activitycontinuation:${ngrokUrl}`,\n      // highlight-next-line\n      `webcredentials:${ngrokUrl}`,\n      // Add additional production-URLs here.\n      // `applinks:example.com`,\n      // `activitycontinuation:example.com`,\n      // `webcredentials:example.com`,\n    ],\n  },\n\n  plugins: [\n    [\n      "expo-router",\n      {\n        // highlight-next-line\n        headOrigin:\n          process.env.NODE_ENV === "development"\n            ? `https://${ngrokUrl}`\n            : "https://my-website-example.com",\n      },\n    ],\n  ],\n};\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Do not use the development-only ",(0,i.kt)("inlineCode",{parentName:"p"},"?mode=developer")," suffix when testing handoff to native.")),(0,i.kt)("p",null,"After you've configured the Expo Config, sync the changes with your native build ",(0,i.kt)("inlineCode",{parentName:"p"},"npx expo prebuild -p ios"),"."),(0,i.kt)("p",null,"Now you must start the website BEFORE installing the app on your device, this is because when you install the app, the OS will trigger Apple's servers to ping your website for the ",(0,i.kt)("inlineCode",{parentName:"p"},".well-known/apple-app-site-association")," file. If the website is not running, the OS will not be able to find the file and handoff will not work. If this happens, simply rebuild the native app with ",(0,i.kt)("inlineCode",{parentName:"p"},"npx expo run:ios -d"),"."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"In any route that you want to support handoff, you must use the ",(0,i.kt)("inlineCode",{parentName:"p"},"expo-router/head")," component."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"title=app/index.tsx",title:"app/index.tsx"},'import Head from "expo-router/head";\nimport { Text } from "react-native";\n\nexport default function App() {\n  return (\n    <>\n      <Head>\n        // highlight-next-line\n        <meta property="expo:handoff" content="true" />\n      </Head>\n      <Text>Hello World</Text>\n    </>\n  );\n}\n')),(0,i.kt)("h3",{id:"meta-tags"},"Meta Tags"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"expo-router/head")," component supports the following meta tags:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"expo:handoff")," - Set to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," to enable handoff for the current route. iOS-only. Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"expo:spotlight")," - Set to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," to enable spotlight search for the current route. iOS-only. Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"og:url")," - Set the URL that should be opened when the user switches to your app. Defaults to the current URL in-app with ",(0,i.kt)("inlineCode",{parentName:"li"},"headOrigin")," prop in the ",(0,i.kt)("inlineCode",{parentName:"li"},"expo-router")," Config Plugin, as the baseURL. Passing a relative path will append the ",(0,i.kt)("inlineCode",{parentName:"li"},"headOrigin")," to the path."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"og:title")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"<title>")," - Set the title for the ",(0,i.kt)("inlineCode",{parentName:"li"},"NSUserActivity")," this is unused with handoff."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"og:description")," - Set the description for the ",(0,i.kt)("inlineCode",{parentName:"li"},"NSUserActivity")," this is unused with handoff.")),(0,i.kt)("p",null,"You may want to switch the values between platforms, for that you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"Platform.select"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"title=app/index.tsx",title:"app/index.tsx"},'import Head from "expo-router/head";\n\nexport default function App() {\n  return (\n    <>\n      <Head>\n        <meta\n          property="og:url"\n          // highlight-next-line\n          content={Platform.select({ web: "https://expo.dev", default: null })}\n        />\n      </Head>\n    </>\n  );\n}\n')),(0,i.kt)("h2",{id:"testing"},"Testing"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Ensure your Apple devices have Handoff enabled: ",(0,i.kt)("a",{parentName:"p",href:"https://support.apple.com/en-us/HT209455"},"Enabling Handoff"),". You can test this by following the steps below, but substituting your app with Safari.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open your native application on your device."),(0,i.kt)("li",{parentName:"ol"},"Navigate to a route in the app that supports handoff, i.e. is rendering the ",(0,i.kt)("inlineCode",{parentName:"li"},"<Head />")," element from Expo Router."),(0,i.kt)("li",{parentName:"ol"},"To switch to your Mac, click the app's Handoff icon in the Dock.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Apple Handoff from Apple device to Mac computer",src:n(1699).Z,width:"700",height:"350"})),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"To switch to your iPhone or iPad, open the App Switcher, as you would when switching between apps, then tap the app banner at the bottom of the screen.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Apple Handoff from Apple device to iPhone in the App Switcher",src:n(4879).Z,width:"700",height:"500"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"If you only see the Safari icon in your iPhone's App Switcher, then handoff is not working. Follow the ",(0,i.kt)("a",{parentName:"p",href:"#trouble-shooting"},"Trouble Shooting")," section below.")),(0,i.kt)("h2",{id:"trouble-shooting"},"Trouble Shooting"),(0,i.kt)("p",null,"You can test the Apple App Site Association file (",(0,i.kt)("inlineCode",{parentName:"p"},"public/.well-known/apple-app-site-association"),") by using a validator like this one: ",(0,i.kt)("a",{parentName:"p",href:"https://branch.io/resources/aasa-validator/"},"AASA Validator"),"."),(0,i.kt)("p",null,"If you're having issues, the best thing you can do is enable the most aggressive handoff settings in your app, this will ensure that any possible route is linkable. You can do this like so:"),(0,i.kt)("p",null,"Ensure your ",(0,i.kt)("inlineCode",{parentName:"p"},"public/.well-known/apple-app-site-association")," file matches all routes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:"title=public/.well-known/apple-app-site-association",title:"public/.well-known/apple-app-site-association"},'{\n  "applinks": {\n    "details": [\n      {\n        "appIDs": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"],\n        "components": [\n          {\n            // highlight-next-line\n            "/": "*",\n            // highlight-next-line\n            "comment": "Matches all routes"\n          }\n        ]\n      }\n    ]\n  },\n  "activitycontinuation": {\n    "apps": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"]\n  },\n  "webcredentials": {\n    "apps": ["<APPLE_TEAM_ID>.<IOS_BUNDLE_ID>"]\n  }\n}\n')),(0,i.kt)("p",null,"In the application, ensure you are not rendering the ",(0,i.kt)("inlineCode",{parentName:"p"},"<Head />")," element conditionally (e.g. in an if/else block), it must be rendered on every page that you want to support handoff. We recommend adding it to the ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/root-layout"},"Root Layout")," component to ensure every route is linkable while debugging."),(0,i.kt)("p",null,"The URL should be something like: ",(0,i.kt)("inlineCode",{parentName:"p"},"https://bacon-router-sandbox.ngrok.io/.well-known/apple-app-site-association")),(0,i.kt)("p",null,"Ensure you can access the Ngrok URL (via the browser for example), before building (installing) the app on your device. If you can't access the URL, the OS will not be able to find the file and handoff will not work."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"npx expo run:ios")," and Xcode will both codesign your app when associated domains is setup, this is required for handoff and universal links to work."),(0,i.kt)("p",null,"Handoff between your Mac and iPhone/iPad is not supported in the Expo Go app. You must build and install your app on your device."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"If you see the Safari icon in the App Switcher on your iPhone"),", then it means handoff is not working."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ensure you are not using the ",(0,i.kt)("inlineCode",{parentName:"li"},"?mode=developer")," suffix when testing handoff to native."),(0,i.kt)("li",{parentName:"ul"},"Also be sure you're not using the local development server URL, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:8081")," as this cannot be used as a valid app site association link, open the running Ngrok URL in your browser to test."),(0,i.kt)("li",{parentName:"ul"},"We've observed that in iOS 16.3.1 and macOS 13.0 (Ventura), bundle identifiers starting with ",(0,i.kt)("inlineCode",{parentName:"li"},"app.")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"io.")," will ",(0,i.kt)("em",{parentName:"li"},"sometimes")," not trigger the native app to show up in the iOS task switcher. Use ",(0,i.kt)("inlineCode",{parentName:"li"},"com.")," as the first part of your bundle identifier.")),(0,i.kt)("p",null,"Ensure your ",(0,i.kt)("inlineCode",{parentName:"p"},"public/.well-known/apple-app-site-association")," file contains the ",(0,i.kt)("inlineCode",{parentName:"p"},"activitycontinuation")," field."),(0,i.kt)("p",null,"Your ",(0,i.kt)("inlineCode",{parentName:"p"},"public/.well-known/apple-app-site-association")," must be served from a secure URL (HTTPS). If you are using a development tunnel, you must use the ",(0,i.kt)("inlineCode",{parentName:"p"},"EXPO_TUNNEL_SUBDOMAIN")," environment variable to configure the subdomain for your development tunnel. The tunnel is required for testing in development because you need SSL to use universal links, Expo CLI provides built-in support for this by running ",(0,i.kt)("inlineCode",{parentName:"p"},"npx expo start --tunnel"),"."),(0,i.kt)("p",null,"Check your ",(0,i.kt)("inlineCode",{parentName:"p"},"ios/<project>/<project>.entitlements")," file, under the ",(0,i.kt)("inlineCode",{parentName:"p"},"com.apple.developer.associated-domains")," key. This should contain the same domains as your web server / website. The URL should be not contain a protocol (",(0,i.kt)("inlineCode",{parentName:"p"},"https://"),") or additional pathname, query parameters, or fragments."),(0,i.kt)("h3",{id:"still-stuck"},"Still Stuck?"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This is an important but very difficult feature to setup. Expo Router automates many of the moving parts, Expo CLI automates much of the configuration and hosting, but hardware settings can still be misconfigured!")),(0,i.kt)("p",null,"If all else fails, you can try to debug the issue by following the steps in the ",(0,i.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/foundation/task_management/implementing_handoff_in_your_app"},"Apple Docs"),". Note that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"Representing user activities as instances of ',(0,i.kt)("inlineCode",{parentName:"li"},"NSUserActivity"),'." is performed by the Expo Head native module.'),(0,i.kt)("li",{parentName:"ul"},'"Updating the activity instances as the user performs actions in your app." is performed by mounting/rendering the ',(0,i.kt)("inlineCode",{parentName:"li"},"<Head />")," component with the meta tag ",(0,i.kt)("inlineCode",{parentName:"li"},'<meta property="expo:handoff" content="true" />')," inside."),(0,i.kt)("li",{parentName:"ul"},'"Receiving activities from Handoff in your app on other devices." is performed by an ',(0,i.kt)("a",{parentName:"li",href:"https://docs.expo.dev/modules/appdelegate-subscribers/"},"App Delegate Subscriber")," in the Expo Head native module. It is used to redirect you to the correct route when you handoff to your native app.")),(0,i.kt)("h2",{id:"known-issues"},"Known Issues"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Handoff from web (Chrome) to native, does not appear to support Client-side Routing. This means the URL presented in the App Switcher will be the URL of the page you were on when you clicked the link, or reloaded the page. This appears to be a limitation of the web platform, and not something that can be fixed by Expo Router.")))}d.isMDXComponent=!0},4879:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/iphone-handoff-7a9052ae4baf1763045b2fdd71d9e0c9.png"},1699:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/macos-handoff-970c1a287366a9a4296de7b05cf23600.png"}}]);